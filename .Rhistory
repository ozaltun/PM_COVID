ub_list <- c(ub_list, confint(output.new.temp, level = 0.95)[cf_name,][2])
}
}
for(date in time_series_columns){
df["deaths_per_capita_new"] <- df[date]/df["population"] *1000
output.new.temp <- felm(deaths_per_capita_new~  mean_pm25
+ share.drive +share.PublicTransit +share.Bike +share.Walk +share.Home
+ percent.smokers + percent.obese + percent.diabetic +  percent.ICU.Beds + percent.uninsured+poverty
+ pct_owner_occ + pct_white + hispanic
+ pct_blk + older_pecent
+ log(mean_summer_temp) + log(mean_winter_temp) + log(medianhousevalue)
+ log(population)|factor(q_popdensity)+factor(first_case_week_numeric)+ factor(education_bins)+ factor(income_bins)  |0|state, cmethod="reghdfe", data = subset(df, fips != 36061), weights=population_without_new_york)
coefs <- names(coef(output.new.temp))# [names(coef(output.new.3))]
for(cf_name in coefs){
type_list <- c(type_list, "without_states")
date_list <- c(date_list, date)
cf_name_list <- c(cf_name_list, cf_name)
coef_list <- c(coef_list,coef(output.new.temp)[cf_name])
lb_list <- c(lb_list, confint(output.new.temp, level = 0.95)[cf_name,][1])
ub_list <- c(ub_list, confint(output.new.temp, level = 0.95)[cf_name,][2])
}
}
cf_name_estimate <- data.frame(type = type_list,
date = date_list,
cf_name = cf_name_list,
est = coef_list,
lb = lb_list,
ub = ub_list)
write.csv(cf_name_estimate, paste0("/Users/ozaltun/Dropbox (MIT)/Data/Health/covid/",date_of_study,"_estimates.csv"))
library("tidyr")
library("pscl")
library("MASS")
library(NBZIMM)
library("lfe")
library("lme4")
library("stargazer")
library("xtable")
source('Preprocessing_v2.R')
glmm.zinb.off = glmm.zinb(fixed = Deaths ~ mean_pm25 +scale(poverty) + scale(popdensity)  +scale(medianhousevalue)
+scale(medhouseholdincome) + scale(pct_owner_occ)  +scale(hispanic)
+scale(education)  +scale(pct_blk) + scale(older_pecent)
+ scale(totalTestResults) +
+ scale(beds)
+ scale(mean_bmi) + scale(smoke_rate)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ offset(log(population)),
random = ~ 1 | state, data = (aggregate_pm_census_cdc_test_beds))
glmm.zinb.counties = glmm.zinb(fixed = Deaths ~ mean_pm25
+scale(poverty) + scale(popdensity)  +scale(medianhousevalue)
+scale(medhouseholdincome) + scale(pct_owner_occ)  +scale(hispanic)
+scale(education)  +scale(pct_blk) + scale(older_pecent)
+ scale(totalTestResults)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ offset(log(population)),
random = ~ 1 | state, data = (aggregate_pm_census_cdc_test_beds))
glmm.zinb.FE <- glmm.zinb(fixed = Deaths ~ mean_pm25
+ scale(poverty)  + scale(medianhousevalue)
+ scale(pct_owner_occ)  + scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(tests_per_capita)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ log(population)
+ factor(state) + factor(first_case_week)+ factor(education_bins)+ factor(income_bins) + factor(q_popdensity),
random = ~ 1 | state, data = df)
glmm.zinb.health <- glmm.zinb(fixed = Deaths ~ mean_pm25
+ percent.smokers + percent.obese + percent.diabetic + percent.uninsured + scale(ICU.Beds)
+ scale(poverty)  + scale(medianhousevalue)
+ scale(pct_owner_occ)  + scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(tests_per_capita)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ log(population)
+ factor(state) + factor(first_case_week)+ factor(education_bins)+ factor(income_bins) + factor(q_popdensity),
random = ~ 1 | state, data = df)
glmm.zinb.transport <- glmm.zinb(fixed = Deaths ~ mean_pm25
+ scale(share.drive) +scale(share.PublicTransit) +scale(share.Bike) +scale(share.Walk) +scale(share.Home)
+ scale(poverty)  + scale(medianhousevalue)
+ scale(pct_owner_occ)  + scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(tests_per_capita)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ log(population)
+ factor(state) + factor(first_case_week)+ factor(education_bins)+ factor(income_bins) + factor(q_popdensity),
random = ~ 1 | state, data = df)
glmm.zinb.health.transport <- glmm.zinb(fixed = Deaths ~ mean_pm25
+ scale(share.drive) +scale(share.PublicTransit) +scale(share.Bike) +scale(share.Walk) +scale(share.Home)
+ percent.smokers + percent.obese + percent.diabetic + percent.uninsured + scale(ICU.Beds)
+ scale(poverty)  + scale(medianhousevalue)
+ scale(pct_owner_occ)  + scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(tests_per_capita)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ log(population)
+ factor(state) + factor(first_case_week)+ factor(education_bins)+ factor(income_bins) + factor(q_popdensity),
random = ~ 1 | state, data = df)
glmm.zinb.health.transport.capita <- glmm.zinb(fixed = deaths_per_capita ~ mean_pm25
+ scale(share.drive) +scale(share.PublicTransit) +scale(share.Bike) +scale(share.Walk) +scale(share.Home)
+ percent.smokers + percent.obese + percent.diabetic + percent.uninsured + scale(ICU.Beds)
+ scale(poverty)  + scale(medianhousevalue)
+ scale(pct_owner_occ)  + scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(tests_per_capita)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ log(population)
+ factor(state) + factor(first_case_week)+ factor(education_bins)+ factor(income_bins) + factor(q_popdensity),
random = ~ 1 | state, data = df)
linear.FE <- felm(fixed = Deaths ~ mean_pm25
+ scale(poverty)  + scale(medianhousevalue)
+ scale(pct_owner_occ)  + scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(tests_per_capita)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ log(population)|factor(state) + factor(first_case_week)+ factor(education_bins)+ factor(income_bins) + factor(q_popdensity)|0| cmethod="reghdfe", data = df)
glmm.zinb.FE <- glmm.zinb(fixed = Deaths ~ mean_pm25
+ scale(poverty)  + scale(medianhousevalue)
+ scale(pct_owner_occ)  + scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ log(population)
+ factor(state) + factor(first_case_week)+ factor(education_bins)+ factor(income_bins) + factor(q_popdensity),
random = ~ 1 | state, data = df)
glmm.zinb.health <- glmm.zinb(fixed = Deaths ~ mean_pm25
+ percent.smokers + percent.obese + percent.diabetic + percent.uninsured + scale(ICU.Beds)
+ scale(poverty)  + scale(medianhousevalue)
+ scale(pct_owner_occ)  + scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ log(population)
+ factor(state) + factor(first_case_week)+ factor(education_bins)+ factor(income_bins) + factor(q_popdensity),
random = ~ 1 | state, data = df)
glmm.zinb.transport <- glmm.zinb(fixed = Deaths ~ mean_pm25
+ scale(share.drive) +scale(share.PublicTransit) +scale(share.Bike) +scale(share.Walk) +scale(share.Home)
+ scale(poverty)  + scale(medianhousevalue)
+ scale(pct_owner_occ)  + scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ log(population)
+ factor(state) + factor(first_case_week)+ factor(education_bins)+ factor(income_bins) + factor(q_popdensity),
random = ~ 1 | state, data = df)
glmm.zinb.health.transport <- glmm.zinb(fixed = Deaths ~ mean_pm25
+ scale(share.drive) +scale(share.PublicTransit) +scale(share.Bike) +scale(share.Walk) +scale(share.Home)
+ percent.smokers + percent.obese + percent.diabetic + percent.uninsured + scale(ICU.Beds)
+ scale(poverty)  + scale(medianhousevalue)
+ scale(pct_owner_occ)  + scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ log(population)
+ factor(state) + factor(first_case_week)+ factor(education_bins)+ factor(income_bins) + factor(q_popdensity),
random = ~ 1 | state, data = df)
glmm.zinb.health.transport.capita <- glmm.zinb(fixed = deaths_per_thousand ~ mean_pm25
+ scale(share.drive) +scale(share.PublicTransit) +scale(share.Bike) +scale(share.Walk) +scale(share.Home)
+ percent.smokers + percent.obese + percent.diabetic + percent.uninsured + scale(ICU.Beds)
+ scale(poverty)  + scale(medianhousevalue)
+ scale(pct_owner_occ)  + scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ log(population)
+ factor(state) + factor(first_case_week)+ factor(education_bins)+ factor(income_bins) + factor(q_popdensity),
random = ~ 1 | state, data = df)
linear.FE <- felm(fixed = Deaths ~ mean_pm25
+ scale(poverty)  + scale(medianhousevalue)
+ scale(pct_owner_occ)  + scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ log(population)|factor(state) + factor(first_case_week)+ factor(education_bins)+ factor(income_bins) + factor(q_popdensity)|0| cmethod="reghdfe", data = df)
linear.FE <- felm(Deaths ~ mean_pm25
+ scale(poverty)  + scale(medianhousevalue)
+ scale(pct_owner_occ)  + scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ log(population)|factor(state) + factor(first_case_week)+ factor(education_bins)+ factor(income_bins) + factor(q_popdensity)|0| cmethod="reghdfe", data = df)
linear.FE <- felm(Deaths ~ mean_pm25
+ scale(poverty)  + scale(medianhousevalue)
+ scale(pct_owner_occ)  + scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ log(population)|factor(state) + factor(first_case_week)+ factor(education_bins)+ factor(income_bins) + factor(q_popdensity)|0|state, cmethod="reghdfe", data = df)
summary(linear.FE)
signif(intervals(linear.fe, level=0.95, which="fixed")$fixed[2,],3)
signif(intervals(linear.FE, level=0.95, which="fixed")$fixed[2,],3)
signif(intervals(linear.FE, level=0.95)$fixed[2,],3)
intervals(linear.FE, level=0.95)
confint(linear.FE, level = 0.95)
confint(linear.FE, level = 0.95)["mean_pm25",]
confint(linear.FE, level = 0.95)["mean_pm25",][1]
c(confint(linear.FE, level = 0.95)["mean_pm25",][1], coef(linear.FE["mean_pm25"]), confint(linear.FE, level = 0.95)["mean_pm25",][2])
coef(linear.FE["mean_pm25"])
coef(linear.FE)
coef(linear.FE) c(confint(linear.FE, level = 0.95)["mean_pm25",][1], coef(linear.FE)["mean_pm25"], confint(linear.FE, level = 0.95)["mean_pm25",][2])
c(confint(linear.FE, level = 0.95)["mean_pm25",][1], coef(linear.FE)["mean_pm25"], confint(linear.FE, level = 0.95)["mean_pm25",][2])
reg.list <- list(
c("Original Setup",signif(intervals(glmm.zinb.off, level=0.95, which="fixed")$fixed[2,], 3)),
c("Original Setup - Health Impacts",signif(intervals(glmm.zinb.counties, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup",signif(intervals(glmm.zinb.FE, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Health",signif(intervals(glmm.zinb.health, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Transport",signif(intervals(glmm.zinb.transport, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Heatlh + Transport",signif(intervals(glmm.zinb.health.transport, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Model"), c(confint(linear.FE, level = 0.95)["mean_pm25",][1], coef(linear.FE)["mean_pm25"], confint(linear.FE, level = 0.95)["mean_pm25",][2]))
reg.df <- data.frame(do.call(rbind, reg.list))
colnames(reg.df) <- c("Regression",  "Lower Bound", "Estimate","Upper Bound")
View(reg.df)
reg.list <- list(
c("Original Setup",signif(intervals(glmm.zinb.off, level=0.95, which="fixed")$fixed[2,], 3)),
c("Original Setup - Health Impacts",signif(intervals(glmm.zinb.counties, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup",signif(intervals(glmm.zinb.FE, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Health",signif(intervals(glmm.zinb.health, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Transport",signif(intervals(glmm.zinb.transport, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Heatlh + Transport",signif(intervals(glmm.zinb.health.transport, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Model"), list(confint(linear.FE, level = 0.95)["mean_pm25",][1], coef(linear.FE)["mean_pm25"], confint(linear.FE, level = 0.95)["mean_pm25",][2]))
reg.df <- data.frame(do.call(rbind, reg.list))
colnames(reg.df) <- c("Regression",  "Lower Bound", "Estimate","Upper Bound")
View(reg.df)
?type
typeof(signif(intervals(glmm.zinb.health.transport, level=0.95, which="fixed")$fixed[2,], 3))
signif(intervals(glmm.zinb.health.transport, level=0.95, which="fixed")$fixed[2,], 3)
?signif
reg.list <- list(
c("Original Setup",signif(intervals(glmm.zinb.off, level=0.95, which="fixed")$fixed[2,], 3)),
c("Original Setup - Health Impacts",signif(intervals(glmm.zinb.counties, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup",signif(intervals(glmm.zinb.FE, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Health",signif(intervals(glmm.zinb.health, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Transport",signif(intervals(glmm.zinb.transport, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Heatlh + Transport",signif(intervals(glmm.zinb.health.transport, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Model",confint(linear.FE, level = 0.95)["mean_pm25",][1], coef(linear.FE)["mean_pm25"], confint(linear.FE, level = 0.95)["mean_pm25",][2]))
reg.df <- data.frame(do.call(rbind, reg.list))
colnames(reg.df) <- c("Regression",  "Lower Bound", "Estimate","Upper Bound")
View(reg.df)
linear.health.transport <- felm(deaths_per_thousand ~  mean_pm25
+ share.drive +share.PublicTransit +share.Bike +share.Walk +share.Home
+ percent.smokers + percent.obese + percent.diabetic +  percent.ICU.Beds + percent.uninsured+poverty
+ pct_owner_occ + pct_white + hispanic
+ pct_blk + older_pecent
+ log(mean_summer_temp) + log(mean_winter_temp) + log(medianhousevalue)
+ log(population)+factor(state)|factor(q_popdensity)+factor(first_case_week_numeric)+ factor(education_bins)+ factor(income_bins)  |0|state, cmethod="reghdfe",data = subset(df,fips!=36061), weights=population_without_new_york)
reg.list <- list(
c("Original Setup",signif(intervals(glmm.zinb.off, level=0.95, which="fixed")$fixed[2,], 3)),
c("Original Setup - Health Impacts",signif(intervals(glmm.zinb.counties, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup",signif(intervals(glmm.zinb.FE, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Health",signif(intervals(glmm.zinb.health, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Transport",signif(intervals(glmm.zinb.transport, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Heatlh + Transport",signif(intervals(glmm.zinb.health.transport, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Model",confint(linear.FE, level = 0.95)["mean_pm25",][1], coef(linear.FE)["mean_pm25"], confint(linear.FE, level = 0.95)["mean_pm25",][2]),
c("New Model + Health + Transport",confint(linear.health.transport, level = 0.95)["mean_pm25",][1], coef(linear.health.transport)["mean_pm25"], confint(linear.health.transport, level = 0.95)["mean_pm25",][2]))
reg.df <- data.frame(do.call(rbind, reg.list))
colnames(reg.df) <- c("Regression",  "Lower Bound", "Estimate","Upper Bound")
View(reg.df)
linear.health.transport <- felm(Deaths ~  mean_pm25
+ share.drive +share.PublicTransit +share.Bike +share.Walk +share.Home
+ percent.smokers + percent.obese + percent.diabetic +  percent.ICU.Beds + percent.uninsured+poverty
+ pct_owner_occ + pct_white + hispanic
+ pct_blk + older_pecent
+ log(mean_summer_temp) + log(mean_winter_temp) + log(medianhousevalue)
+ log(population)+factor(state)|factor(q_popdensity)+factor(first_case_week_numeric)+ factor(education_bins)+ factor(income_bins)  |0|state, cmethod="reghdfe",data = subset(df,fips!=36061), weights=population_without_new_york)
reg.list <- list(
c("Original Setup",signif(intervals(glmm.zinb.off, level=0.95, which="fixed")$fixed[2,], 3)),
c("Original Setup - Health Impacts",signif(intervals(glmm.zinb.counties, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup",signif(intervals(glmm.zinb.FE, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Health",signif(intervals(glmm.zinb.health, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Transport",signif(intervals(glmm.zinb.transport, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Heatlh + Transport",signif(intervals(glmm.zinb.health.transport, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Model",confint(linear.FE, level = 0.95)["mean_pm25",][1], coef(linear.FE)["mean_pm25"], confint(linear.FE, level = 0.95)["mean_pm25",][2]),
c("New Model + Health + Transport",confint(linear.health.transport, level = 0.95)["mean_pm25",][1], coef(linear.health.transport)["mean_pm25"], confint(linear.health.transport, level = 0.95)["mean_pm25",][2]))
reg.df <- data.frame(do.call(rbind, reg.list))
colnames(reg.df) <- c("Regression",  "Lower Bound", "Estimate","Upper Bound")
View(reg.df)
population_without_new_york = subset(df,fips!=36061)$population
population_with_new_york = df$population
linear.health.transport <- felm(Deaths ~  mean_pm25
+ share.drive +share.PublicTransit +share.Bike +share.Walk +share.Home
+ percent.smokers + percent.obese + percent.diabetic +  percent.ICU.Beds + percent.uninsured+poverty
+ pct_owner_occ + pct_white + hispanic
+ pct_blk + older_pecent
+ log(mean_summer_temp) + log(mean_winter_temp) + log(medianhousevalue)
+ log(population)+factor(state)|factor(q_popdensity)+factor(first_case_week_numeric)+ factor(education_bins)+ factor(income_bins)  |0|state, cmethod="reghdfe",data = subset(df,fips!=36061), weights=population_without_new_york)
reg.list <- list(
c("Original Setup",signif(intervals(glmm.zinb.off, level=0.95, which="fixed")$fixed[2,], 3)),
c("Original Setup - Health Impacts",signif(intervals(glmm.zinb.counties, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup",signif(intervals(glmm.zinb.FE, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Health",signif(intervals(glmm.zinb.health, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Transport",signif(intervals(glmm.zinb.transport, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Heatlh + Transport",signif(intervals(glmm.zinb.health.transport, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Model",confint(linear.FE, level = 0.95)["mean_pm25",][1], coef(linear.FE)["mean_pm25"], confint(linear.FE, level = 0.95)["mean_pm25",][2]),
c("New Model + Health + Transport",confint(linear.health.transport, level = 0.95)["mean_pm25",][1], coef(linear.health.transport)["mean_pm25"], confint(linear.health.transport, level = 0.95)["mean_pm25",][2]))
reg.df <- data.frame(do.call(rbind, reg.list))
colnames(reg.df) <- c("Regression",  "Lower Bound", "Estimate","Upper Bound")
View(reg.df)
population_without_new_york = subset(df,fips!=36061)$population
population_with_new_york = df$population
linear.FE <- felm(Deaths ~ mean_pm25
+ scale(poverty)  + scale(medianhousevalue)
+ scale(pct_owner_occ)  + scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ log(population)|factor(state) + factor(first_case_week)+ factor(education_bins)+ factor(income_bins) + factor(q_popdensity)|0|state, cmethod="reghdfe", data = df, weights=population_with_new_york)
linear.health.transport <- felm(Deaths ~  mean_pm25
+ share.drive +share.PublicTransit +share.Bike +share.Walk +share.Home
+ percent.smokers + percent.obese + percent.diabetic +  percent.ICU.Beds + percent.uninsured+poverty
+ pct_owner_occ + pct_white + hispanic
+ pct_blk + older_pecent
+ log(mean_summer_temp) + log(mean_winter_temp) + log(medianhousevalue)
+ log(population)+factor(state)|factor(q_popdensity)+factor(first_case_week_numeric)+ factor(education_bins)+ factor(income_bins)  |0|state, cmethod="reghdfe",data = df, weights=population_with_new_york)
reg.list <- list(
c("Original Setup",signif(intervals(glmm.zinb.off, level=0.95, which="fixed")$fixed[2,], 3)),
c("Original Setup - Health Impacts",signif(intervals(glmm.zinb.counties, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup",signif(intervals(glmm.zinb.FE, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Health",signif(intervals(glmm.zinb.health, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Transport",signif(intervals(glmm.zinb.transport, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Heatlh + Transport",signif(intervals(glmm.zinb.health.transport, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Model",confint(linear.FE, level = 0.95)["mean_pm25",][1], coef(linear.FE)["mean_pm25"], confint(linear.FE, level = 0.95)["mean_pm25",][2]),
c("New Model + Health + Transport",confint(linear.health.transport, level = 0.95)["mean_pm25",][1], coef(linear.health.transport)["mean_pm25"], confint(linear.health.transport, level = 0.95)["mean_pm25",][2]))
reg.df <- data.frame(do.call(rbind, reg.list))
colnames(reg.df) <- c("Regression",  "Lower Bound", "Estimate","Upper Bound")
View(reg.df)
population_without_new_york = subset(df,fips!=36061)$population
population_with_new_york = df$population
linear.FE <- felm(deaths_per_thousand ~ mean_pm25
+ scale(poverty)  + scale(medianhousevalue)
+ scale(pct_owner_occ)  + scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ log(population)|factor(state) + factor(first_case_week)+ factor(education_bins)+ factor(income_bins) + factor(q_popdensity)|0|state, cmethod="reghdfe", data = df, weights=population_with_new_york)
linear.health.transport <- felm(deaths_per_thousand ~  mean_pm25
+ share.drive +share.PublicTransit +share.Bike +share.Walk +share.Home
+ percent.smokers + percent.obese + percent.diabetic +  percent.ICU.Beds + percent.uninsured+poverty
+ pct_owner_occ + pct_white + hispanic
+ pct_blk + older_pecent
+ log(mean_summer_temp) + log(mean_winter_temp) + log(medianhousevalue)
+ log(population)+factor(state)|factor(q_popdensity)+factor(first_case_week_numeric)+ factor(education_bins)+ factor(income_bins)  |0|state, cmethod="reghdfe",data = df, weights=population_with_new_york)
reg.list <- list(
c("Original Setup",signif(intervals(glmm.zinb.off, level=0.95, which="fixed")$fixed[2,], 3)),
c("Original Setup - Health Impacts",signif(intervals(glmm.zinb.counties, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup",signif(intervals(glmm.zinb.FE, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Health",signif(intervals(glmm.zinb.health, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Transport",signif(intervals(glmm.zinb.transport, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Heatlh + Transport",signif(intervals(glmm.zinb.health.transport, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Model",confint(linear.FE, level = 0.95)["mean_pm25",][1], coef(linear.FE)["mean_pm25"], confint(linear.FE, level = 0.95)["mean_pm25",][2]),
c("New Model + Health + Transport",confint(linear.health.transport, level = 0.95)["mean_pm25",][1], coef(linear.health.transport)["mean_pm25"], confint(linear.health.transport, level = 0.95)["mean_pm25",][2]))
reg.df <- data.frame(do.call(rbind, reg.list))
colnames(reg.df) <- c("Regression",  "Lower Bound", "Estimate","Upper Bound")
View(reg.df)
population_without_new_york = subset(df,fips!=36061)$population
population_with_new_york = df$population
linear.FE <- felm(deaths_per_thousand ~ mean_pm25
+ share.drive +share.PublicTransit +share.Bike +share.Walk +share.Home
+ percent.smokers + percent.obese + percent.diabetic +  percent.ICU.Beds + percent.uninsured+poverty
+ pct_owner_occ + pct_white + hispanic
+ pct_blk + older_pecent
+ log(mean_summer_temp) + log(mean_winter_temp) + log(medianhousevalue)
+ log(population)|factor(state) + factor(first_case_week)+ factor(education_bins)+ factor(income_bins) + factor(q_popdensity)|0|state, cmethod="reghdfe", data = df, weights=population_with_new_york)
linear.health.transport <- felm(deaths_per_thousand ~  mean_pm25
+ share.drive +share.PublicTransit +share.Bike +share.Walk +share.Home
+ percent.smokers + percent.obese + percent.diabetic +  percent.ICU.Beds + percent.uninsured+poverty
+ pct_owner_occ + pct_white + hispanic
+ pct_blk + older_pecent
+ log(mean_summer_temp) + log(mean_winter_temp) + log(medianhousevalue)
+ log(population)|factor(q_popdensity)+factor(first_case_week_numeric)+ factor(education_bins)+ factor(income_bins) +factor(state) |0|state, cmethod="reghdfe",data = df, weights=population_with_new_york)
reg.list <- list(
c("Original Setup",signif(intervals(glmm.zinb.off, level=0.95, which="fixed")$fixed[2,], 3)),
c("Original Setup - Health Impacts",signif(intervals(glmm.zinb.counties, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup",signif(intervals(glmm.zinb.FE, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Health",signif(intervals(glmm.zinb.health, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Transport",signif(intervals(glmm.zinb.transport, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Setup + Heatlh + Transport",signif(intervals(glmm.zinb.health.transport, level=0.95, which="fixed")$fixed[2,], 3)),
c("New Model",confint(linear.FE, level = 0.95)["mean_pm25",][1], coef(linear.FE)["mean_pm25"], confint(linear.FE, level = 0.95)["mean_pm25",][2]),
c("New Model + Health + Transport",confint(linear.health.transport, level = 0.95)["mean_pm25",][1], coef(linear.health.transport)["mean_pm25"], confint(linear.health.transport, level = 0.95)["mean_pm25",][2]))
reg.df <- data.frame(do.call(rbind, reg.list))
colnames(reg.df) <- c("Regression",  "Lower Bound", "Estimate","Upper Bound")
View(reg.df)
20
source('~/Documents/GitHub/PM_COVID/Preprocessing_v2.R')
library("lfe")
library("dplyr")
library("pscl")
library("MASS")
library(NBZIMM)
library("lme4")
date_of_study = "05-19-2020"
# df <- read.csv(paste0("/Users/ozaltun/Dropbox (MIT)/Data/Health/covid/",date_of_study,"_df.csv"))
population_without_new_york = subset(df,fips!=36061)$population
population_with_new_york = df$population
# Matches Stata Initial_BO.do
output.new <- felm(deaths_per_thousand ~  mean_pm25
+ share.drive +share.PublicTransit +share.Bike +share.Walk +share.Home
+ percent.smokers + percent.obese + percent.diabetic +  percent.ICU.Beds + percent.uninsured+poverty
+ pct_owner_occ + pct_white + hispanic
+ pct_blk + older_pecent
+ log(mean_summer_temp) + log(mean_winter_temp) + log(medianhousevalue)
+ log(population)+factor(state)|factor(q_popdensity)+factor(first_case_week_numeric)+ factor(education_bins)+ factor(income_bins)  |0|state, cmethod="reghdfe",data = subset(df,fips!=36061), weights=population_without_new_york)
summary(output.new)
# Esimating this for every time step.
type_list <- c()
date_list <- c()
cf_name_list <- c()
coef_list <- c()
lb_list<- c()
ub_list<-c()
for(date in time_series_columns){
df["deaths_per_capita_new"] <- df[date]/df["population"] *1000
output.new.temp <- felm(deaths_per_capita_new~ mean_pm25
+ share.drive +share.PublicTransit +share.Bike +share.Walk +share.Home
+ percent.smokers + percent.obese + percent.diabetic +  percent.ICU.Beds + percent.uninsured+poverty
+ pct_owner_occ + pct_white + hispanic
+ pct_blk + older_pecent
+ log(mean_summer_temp) + log(mean_winter_temp) + log(medianhousevalue)
+ log(population)+factor(state)|factor(q_popdensity)+factor(first_case_week_numeric)+ factor(education_bins)+ factor(income_bins)  |0|state, cmethod="reghdfe", data = subset(df, fips != 36061), weights=population_without_new_york)
coefs <- names(coef(output.new.temp))#[names(coef(output.new.3))]
for(cf_name in coefs){
type_list <- c(type_list, "with_states")
date_list <- c(date_list, date)
cf_name_list <- c(cf_name_list, cf_name)
coef_list <- c(coef_list,coef(output.new.temp)[cf_name])
lb_list <- c(lb_list, confint(output.new.temp, level = 0.95)[cf_name,][1])
ub_list <- c(ub_list, confint(output.new.temp, level = 0.95)[cf_name,][2])
}
}
for(date in time_series_columns){
df["deaths_per_capita_new"] <- df[date]/df["population"] *1000
output.new.temp <- felm(deaths_per_capita_new~  mean_pm25
+ share.drive +share.PublicTransit +share.Bike +share.Walk +share.Home
+ percent.smokers + percent.obese + percent.diabetic +  percent.ICU.Beds + percent.uninsured+poverty
+ pct_owner_occ + pct_white + hispanic
+ pct_blk + older_pecent
+ log(mean_summer_temp) + log(mean_winter_temp) + log(medianhousevalue)
+ log(population)|factor(q_popdensity)+factor(first_case_week_numeric)+ factor(education_bins)+ factor(income_bins)  |0|state, cmethod="reghdfe", data = subset(df, fips != 36061), weights=population_without_new_york)
coefs <- names(coef(output.new.temp))# [names(coef(output.new.3))]
for(cf_name in coefs){
type_list <- c(type_list, "without_states")
date_list <- c(date_list, date)
cf_name_list <- c(cf_name_list, cf_name)
coef_list <- c(coef_list,coef(output.new.temp)[cf_name])
lb_list <- c(lb_list, confint(output.new.temp, level = 0.95)[cf_name,][1])
ub_list <- c(ub_list, confint(output.new.temp, level = 0.95)[cf_name,][2])
}
}
cf_name_estimate <- data.frame(type = type_list,
date = date_list,
cf_name = cf_name_list,
est = coef_list,
lb = lb_list,
ub = ub_list)
write.csv(cf_name_estimate, paste0("/Users/ozaltun/Dropbox (MIT)/Data/Health/covid/",date_of_study,"_estimates.csv"))
library("lfe")
library("dplyr")
library("pscl")
library("MASS")
library(NBZIMM)
library("lme4")
date_of_study = "05-20-2020"
# df <- read.csv(paste0("/Users/ozaltun/Dropbox (MIT)/Data/Health/covid/",date_of_study,"_df.csv"))
population_without_new_york = subset(df,fips!=36061)$population
population_with_new_york = df$population
# Matches Stata Initial_BO.do
output.new <- felm(deaths_per_thousand ~  mean_pm25
+ share.drive +share.PublicTransit +share.Bike +share.Walk +share.Home
+ percent.smokers + percent.obese + percent.diabetic +  percent.ICU.Beds + percent.uninsured+poverty
+ pct_owner_occ + pct_white + hispanic
+ pct_blk + older_pecent
+ log(mean_summer_temp) + log(mean_winter_temp) + log(medianhousevalue)
+ log(population)+factor(state)|factor(q_popdensity)+factor(first_case_week_numeric)+ factor(education_bins)+ factor(income_bins)  |0|state, cmethod="reghdfe",data = subset(df,fips!=36061), weights=population_without_new_york)
summary(output.new)
# Esimating this for every time step.
type_list <- c()
date_list <- c()
cf_name_list <- c()
coef_list <- c()
lb_list<- c()
ub_list<-c()
for(date in time_series_columns){
df["deaths_per_capita_new"] <- df[date]/df["population"] *1000
output.new.temp <- felm(deaths_per_capita_new~ mean_pm25
+ share.drive +share.PublicTransit +share.Bike +share.Walk +share.Home
+ percent.smokers + percent.obese + percent.diabetic +  percent.ICU.Beds + percent.uninsured+poverty
+ pct_owner_occ + pct_white + hispanic
+ pct_blk + older_pecent
+ log(mean_summer_temp) + log(mean_winter_temp) + log(medianhousevalue)
+ log(population)+factor(state)|factor(q_popdensity)+factor(first_case_week_numeric)+ factor(education_bins)+ factor(income_bins)  |0|state, cmethod="reghdfe", data = subset(df, fips != 36061), weights=population_without_new_york)
coefs <- names(coef(output.new.temp))#[names(coef(output.new.3))]
for(cf_name in coefs){
type_list <- c(type_list, "with_states")
date_list <- c(date_list, date)
cf_name_list <- c(cf_name_list, cf_name)
coef_list <- c(coef_list,coef(output.new.temp)[cf_name])
lb_list <- c(lb_list, confint(output.new.temp, level = 0.95)[cf_name,][1])
ub_list <- c(ub_list, confint(output.new.temp, level = 0.95)[cf_name,][2])
}
}
for(date in time_series_columns){
df["deaths_per_capita_new"] <- df[date]/df["population"] *1000
output.new.temp <- felm(deaths_per_capita_new~  mean_pm25
+ share.drive +share.PublicTransit +share.Bike +share.Walk +share.Home
+ percent.smokers + percent.obese + percent.diabetic +  percent.ICU.Beds + percent.uninsured+poverty
+ pct_owner_occ + pct_white + hispanic
+ pct_blk + older_pecent
+ log(mean_summer_temp) + log(mean_winter_temp) + log(medianhousevalue)
+ log(population)|factor(q_popdensity)+factor(first_case_week_numeric)+ factor(education_bins)+ factor(income_bins)  |0|state, cmethod="reghdfe", data = subset(df, fips != 36061), weights=population_without_new_york)
coefs <- names(coef(output.new.temp))# [names(coef(output.new.3))]
for(cf_name in coefs){
type_list <- c(type_list, "without_states")
date_list <- c(date_list, date)
cf_name_list <- c(cf_name_list, cf_name)
coef_list <- c(coef_list,coef(output.new.temp)[cf_name])
lb_list <- c(lb_list, confint(output.new.temp, level = 0.95)[cf_name,][1])
ub_list <- c(ub_list, confint(output.new.temp, level = 0.95)[cf_name,][2])
}
}
cf_name_estimate <- data.frame(type = type_list,
date = date_list,
cf_name = cf_name_list,
est = coef_list,
lb = lb_list,
ub = ub_list)
write.csv(cf_name_estimate, paste0("/Users/ozaltun/Dropbox (MIT)/Data/Health/covid/",date_of_study,"_estimates.csv"))
