time_series_estimate$model <- factor(time_series_estimate$model, levels = time_series_estimate$model)
ggplot(time_series_estimate, aes(x = model, y = est)) +
geom_point() +
geom_errorbar(aes(ymin = lb, ymax = ub), width = 0.1) +
xlab("") +
ylab("Historical predictor")
# Initial FE setup
output.new.1 <- felm(log(Deaths+1) ~ mean_pm25+scale(poverty) +scale(medianhousevalue)
+ scale(pct_owner_occ)  +scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ scale(totalTestResults)
+ log(population)|factor(q_popdensity) +state+factor(first_case_week)+ factor(education_bins)+ factor(income_bins)  |0|q_popdensity, cmethod="reghdfe", data = df)
# Looking at deaths per capita
output.new.2 <- felm(deaths_per_capita ~ mean_pm25+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME+scale(poverty) +scale(medianhousevalue)
+ scale(pct_owner_occ)  +scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ scale(totalTestResults)
+ log(population)|factor(q_popdensity) +state+factor(first_case_week)+ factor(education_bins)+ factor(income_bins)  |0|q_popdensity, cmethod="reghdfe", data = df)
# Incorporating transportation method
output.new.3 <- felm(log(Deaths+1) ~ mean_pm25
+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME
+ scale(poverty) +scale(medianhousevalue)
+ scale(pct_owner_occ)  +scale(hispanic) + scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ scale(totalTestResults)
+ log(population)
|factor(q_popdensity) + state + factor(first_case_week)+ factor(education_bins)+ factor(income_bins)
|0|q_popdensity, cmethod="reghdfe", data = df)
stargazer(output.new.1, output.new.3, output.new.2, title= "All counties", keep=c("mean_pm25"), omit.stat = c("LL","ser","f","rsq"), style = "qje"
, dep.var.labels=c("log(Deaths)", "Deaths per Capita")
, add.lines=list(c("Controls + FE", "X", "X","X"), c("Transportation", "","X", "X")), type='html')
# main analysis
glmm.zinb.counties = glmm.zinb(fixed = Deaths ~ mean_pm25 +scale(poverty) + scale(popdensity)  +scale(medianhousevalue)
+scale(medhouseholdincome) + scale(pct_owner_occ)  +scale(hispanic)
+scale(education)  +scale(pct_blk) + scale(older_pecent)
+ scale(totalTestResults)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm)
+ scale(mean_winter_rm)
+ offset(log(population)),
random = ~ 1 | q_popdensity, data = (aggregate_pm_census_cdc_test_beds))
cat('5%, Estimate, 95%:',intervals(glmm.zinb.counties, level=0.95)$fixed[2,], '\n')
View(glmm.zinb.off)
# main analysis
glmm.zinb.counties = glmm.zinb(fixed = Deaths ~ mean_pm25 +scale(poverty) + scale(popdensity)  +scale(medianhousevalue)
+scale(medhouseholdincome) + scale(pct_owner_occ)  +scale(hispanic)
+scale(education)  +scale(pct_blk) + scale(older_pecent)
+ scale(totalTestResults)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm)
+ scale(mean_winter_rm)
+ offset(log(population)),
random = ~ 1 | q_popdensity, data = (aggregate_pm_census_cdc_test_beds), which="fixed")
cat('5%, Estimate, 95%:',intervals(glmm.zinb.counties, level=0.95)$fixed[2,], '\n')
# main analysis
glmm.zinb.counties = glmm.zinb(fixed = Deaths ~ mean_pm25 +scale(poverty) + scale(popdensity)  +scale(medianhousevalue)
+scale(medhouseholdincome) + scale(pct_owner_occ)  +scale(hispanic)
+scale(education)  +scale(pct_blk) + scale(older_pecent)
+ scale(totalTestResults)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm)
+ scale(mean_winter_rm)
+ offset(log(population)),
random = ~ 1 | q_popdensity, data = (aggregate_pm_census_cdc_test_beds))
cat('5%, Estimate, 95%:',intervals(glmm.zinb.counties, level=0.95, which="fixed")[2,], '\n')
intervals(glmm.zinb.counties, level=0.95, which="fixed")
# main analysis
glmm.zinb.counties = glmm.zinb(fixed = Deaths ~ mean_pm25 +scale(poverty) + scale(popdensity)  +scale(medianhousevalue)
+scale(medhouseholdincome) + scale(pct_owner_occ)  +scale(hispanic)
+scale(education)  +scale(pct_blk) + scale(older_pecent)
+ scale(totalTestResults)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm)
+ scale(mean_winter_rm)
+ offset(log(population)),
random = ~ 1 | state, data = (aggregate_pm_census_cdc_test_beds))
cat('5%, Estimate, 95%:',intervals(glmm.zinb.counties, level=0.95)$fixed[2,], '\n')
cat("N: ", glmm.zinb.counties$dims$N)
# Ideal regression
output.new.4 <- felm(log(Deaths) ~mean_pm25+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME+poverty +medianhousevalue + pct_owner_occ  +hispanic + pct_blk +older_pecent+ mean_summer_temp + mean_winter_temp + mean_summer_rm + mean_winter_rm + totalTestResults+ log(population)|factor(q_popdensity) +factor(first_case_week) + factor(first_death_week) + factor(state)+ factor(education_bins)+ factor(income_bins)  |0|q_popdensity, cmethod="reghdfe", data = subset(df, Deaths>0))
stargazer(output.new.4, title= "Counties with Death>0", keep=c("mean_pm25"), omit.stat = c("LL","ser","f","rsq"), style = "qje"
, dep.var.labels=c("log(Deaths)")
, add.lines=list(c("Controls + FE", "X"), c("Transportation","X")), type='html')
View(df)
library("tidyr")
library("pscl")
library("MASS")
library(NBZIMM)
library("lfe")
library("lme4")
library("stargazer")
source('Preprocessing_v2.R')
# main analysis
glmm.zinb.off = glmm.zinb(fixed = Deaths ~ mean_pm25 +scale(poverty) + scale(popdensity)  +scale(medianhousevalue)
+scale(medhouseholdincome) + scale(pct_owner_occ)  +scale(hispanic)
+scale(education)  +scale(pct_blk) + scale(older_pecent)
+ scale(totalTestResults) +
+ scale(beds)
+ scale(mean_bmi) + scale(smoke_rate)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ offset(log(population)),
random = ~ 1 | state, data = (aggregate_pm_census_cdc_test_beds))
intervals(glmm.zinb.off, level=0.95)$fixed[2,]
cat("N: ", glmm.zinb.off$dims$N)
# main analysis
glmm.zinb.counties = glmm.zinb(fixed = Deaths ~ mean_pm25 +scale(poverty) + scale(popdensity)  +scale(medianhousevalue)
+scale(medhouseholdincome) + scale(pct_owner_occ)  +scale(hispanic)
+scale(education)  +scale(pct_blk) + scale(older_pecent)
+ scale(totalTestResults)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm)
+ scale(mean_winter_rm)
+ offset(log(population)),
random = ~ 1 | state, data = (aggregate_pm_census_cdc_test_beds))
cat('5%, Estimate, 95%:',intervals(glmm.zinb.counties, level=0.95)$fixed[2,], '\n')
cat("N: ", glmm.zinb.counties$dims$N)
# Initial FE setup
output.new.1 <- felm(log(Deaths+1) ~ mean_pm25+scale(poverty) +scale(medianhousevalue)
+ scale(pct_owner_occ)  +scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ scale(totalTestResults)
+ log(population)|factor(q_popdensity) +state+factor(first_case_week)+ factor(education_bins)+ factor(income_bins)  |0|popdensity_bins, cmethod="reghdfe", data = df)
# Looking at deaths per capita
output.new.2 <- felm(deaths_per_capita ~ mean_pm25+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME+scale(poverty) +scale(medianhousevalue)
+ scale(pct_owner_occ)  +scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ scale(totalTestResults)
+ log(population)|factor(q_popdensity) +state+factor(first_case_week)+ factor(education_bins)+ factor(income_bins)  |0|popdensity_bins, cmethod="reghdfe", data = df)
# Incorporating transportation method
output.new.3 <- felm(log(Deaths+1) ~ mean_pm25
+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME
+ scale(poverty) +scale(medianhousevalue)
+ scale(pct_owner_occ)  +scale(hispanic) + scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ scale(totalTestResults)
+ log(population)
|factor(q_popdensity) + state + factor(first_case_week)+ factor(education_bins)+ factor(income_bins)
|0|popdensity_bins, cmethod="reghdfe", data = df)
stargazer(output.new.1, output.new.3, output.new.2, title= "All counties", keep=c("mean_pm25"), omit.stat = c("LL","ser","f","rsq"), style = "qje"
, dep.var.labels=c("log(Deaths)", "Deaths per Capita")
, add.lines=list(c("Controls + FE", "X", "X","X"), c("Transportation", "","X", "X")), type='html')
# Ideal regression
output.new.4 <- felm(log(Deaths) ~mean_pm25+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME+poverty +medianhousevalue + pct_owner_occ  +hispanic + pct_blk +older_pecent+ mean_summer_temp + mean_winter_temp + mean_summer_rm + mean_winter_rm + totalTestResults+ log(population)|factor(q_popdensity) +factor(first_case_week) + factor(first_death_week) + factor(state)+ factor(education_bins)+ factor(income_bins)  |0|popdensity_bins, cmethod="reghdfe", data = subset(df, Deaths>0))
stargazer(output.new.4, title= "Counties with Death>0", keep=c("mean_pm25"), omit.stat = c("LL","ser","f","rsq"), style = "qje"
, dep.var.labels=c("log(Deaths)")
, add.lines=list(c("Controls + FE", "X"), c("Transportation","X")), type='html')
library("tidyverse")
coef_list <- c()
lb_list<- c()
ub_list<-c()
for(date in time_series_columns){
eq <- paste0("log(",date, "+1) ~ mean_pm25+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME+poverty +medianhousevalue + pct_owner_occ  +hispanic + pct_blk +older_pecent+ mean_summer_temp + mean_winter_temp + mean_summer_rm + mean_winter_rm + totalTestResults+ log(population)|factor(q_popdensity) +factor(first_case_week) + factor(state)+ factor(education_bins)+ factor(income_bins)  |0|popdensity_bins")
output.new.temp <- felm(as.formula(eq), cmethod="reghdfe", data = df)
coef_list <- c(coef_list,coef(output.new.temp)["mean_pm25"])
lb_list <- c(lb_list, confint(output.new.temp, level = 0.95)["mean_pm25", ][1])
ub_list <- c(ub_list, confint(output.new.temp, level = 0.95)["mean_pm25", ][2])
}
time_series_estimate <- data.frame(est = coef_list,
lb = lb_list,
ub = ub_list,
model = time_series_columns)
time_series_estimate$model <- factor(time_series_estimate$model, levels = time_series_estimate$model)
ggplot(time_series_estimate, aes(x = model, y = est)) +
geom_point() +
geom_errorbar(aes(ymin = lb, ymax = ub), width = 0.1) +
xlab("") +
ylab("Historical predictor")
# Ideal regression
output.new.4 <- felm(log(Deaths+1) ~ mean_pm25+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME+poverty +medianhousevalue + pct_owner_occ  +hispanic + pct_blk +older_pecent+ mean_summer_temp + mean_winter_temp + mean_summer_rm + mean_winter_rm + totalTestResults+ log(population)|factor(q_popdensity) +factor(first_case_week) + factor(state)+ factor(education_bins)+ factor(income_bins)  |0|popdensity_bins, cmethod="reghdfe", data = subset(df, Deaths))
# Ideal regression
output.new.4 <- felm(log(Deaths+1) ~ mean_pm25+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME+poverty +medianhousevalue + pct_owner_occ  +hispanic + pct_blk +older_pecent+ mean_summer_temp + mean_winter_temp + mean_summer_rm + mean_winter_rm + totalTestResults+ log(population)|factor(q_popdensity) +factor(first_case_week) + factor(state)+ factor(education_bins)+ factor(income_bins)  |0|popdensity_bins, cmethod="reghdfe", data = df)
stargazer(output.new.4, title= "Counties with Death>0", keep=c("mean_pm25"), omit.stat = c("LL","ser","f","rsq"), style = "qje"
, dep.var.labels=c("log(Deaths)")
, add.lines=list(c("Controls + FE", "X"), c("Transportation","X")), type='html')
library("tidyverse")
coef_list <- c()
lb_list<- c()
ub_list<-c()
for(date in time_series_columns){
eq <- paste0("log(",date, "+1) ~ mean_pm25+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME+poverty +medianhousevalue + pct_owner_occ  +hispanic + pct_blk +older_pecent+ mean_summer_temp + mean_winter_temp + mean_summer_rm + mean_winter_rm + totalTestResults+ log(population)|factor(q_popdensity) +factor(first_case_week) + factor(state)+ factor(education_bins)+ factor(income_bins)  |0|popdensity_bins")
output.new.temp <- felm(as.formula(eq), cmethod="reghdfe", data = df)
coef_list <- c(coef_list,coef(output.new.temp)["mean_pm25"])
lb_list <- c(lb_list, confint(output.new.temp, level = 0.95)["mean_pm25", ][1])
ub_list <- c(ub_list, confint(output.new.temp, level = 0.95)["mean_pm25", ][2])
}
time_series_estimate <- data.frame(est = coef_list,
lb = lb_list,
ub = ub_list,
model = time_series_columns)
time_series_estimate$model <- factor(time_series_estimate$model, levels = time_series_estimate$model)
ggplot(time_series_estimate, aes(x = model, y = est)) +
geom_point() +
geom_errorbar(aes(ymin = lb, ymax = ub), width = 0.1) +
xlab("") +
ylab("Historical predictor")
# Ideal regression
output.new.4 <- felm(log(Deaths + (Deaths^2+1)^0.5) ~ mean_pm25+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME+poverty +medianhousevalue + pct_owner_occ  +hispanic + pct_blk +older_pecent+ mean_summer_temp + mean_winter_temp + mean_summer_rm + mean_winter_rm + totalTestResults+ log(population)|factor(q_popdensity) +factor(first_case_week) + factor(state)+ factor(education_bins)+ factor(income_bins)  |0|popdensity_bins, cmethod="reghdfe", data = df)
stargazer(output.new.4, title= "Counties with Death>0", keep=c("mean_pm25"), omit.stat = c("LL","ser","f","rsq"), style = "qje"
, dep.var.labels=c("log(Deaths)")
, add.lines=list(c("Controls + FE", "X"), c("Transportation","X")), type='html')
library("tidyverse")
coef_list <- c()
lb_list<- c()
ub_list<-c()
for(date in time_series_columns){
eq <- paste0("log(",date," + (",date,"^2+1)^0.5) ~ mean_pm25+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME+poverty +medianhousevalue + pct_owner_occ  +hispanic + pct_blk +older_pecent+ mean_summer_temp + mean_winter_temp + mean_summer_rm + mean_winter_rm + totalTestResults+ log(population)|factor(q_popdensity) +factor(first_case_week) + factor(state)+ factor(education_bins)+ factor(income_bins)  |0|popdensity_bins")
output.new.temp <- felm(as.formula(eq), cmethod="reghdfe", data = df)
coef_list <- c(coef_list,coef(output.new.temp)["mean_pm25"])
lb_list <- c(lb_list, confint(output.new.temp, level = 0.95)["mean_pm25", ][1])
ub_list <- c(ub_list, confint(output.new.temp, level = 0.95)["mean_pm25", ][2])
}
time_series_estimate <- data.frame(est = coef_list,
lb = lb_list,
ub = ub_list,
model = time_series_columns)
time_series_estimate$model <- factor(time_series_estimate$model, levels = time_series_estimate$model)
ggplot(time_series_estimate, aes(x = model, y = est)) +
geom_point() +
geom_errorbar(aes(ymin = lb, ymax = ub), width = 0.1) +
xlab("") +
ylab("Historical predictor")
stargazer(output.new.4, title= "Counties with Death>0", keep=c("mean_pm25"), omit.stat = c("LL","ser","f","rsq"), style = "qje"
, dep.var.labels=c("hsin(Deaths)")
, add.lines=list(c("Controls + FE", "X"), c("Transportation","X")), type='html')
library("tidyverse")
coef_list <- c()
lb_list<- c()
ub_list<-c()
for(date in time_series_columns){
eq <- paste(date,"~ mean_pm25 +scale(poverty) + scale(popdensity)  +scale(medianhousevalue) +scale(medhouseholdincome) + scale(pct_owner_occ)  +scale(hispanic) +scale(education)  +scale(pct_blk) + scale(older_pecent) + scale(totalTestResults) + scale(beds) + scale(mean_bmi) + scale(smoke_rate)+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)+ offset(log(population))")
glmm.zinb.off = glmm.zinb(fixed =as.formula(eq),
random = ~ 1 | state, data = (aggregate_pm_census_cdc_test_beds))
temp_list <- intervals(glmm.zinb.off, level=0.95)$fixed[2,]
coef_list <- c(coef_list,temp_list[2])
lb_list <- c(lb_list, temp_list[1])
ub_list <- c(ub_list, temp_list[3])
}
library("tidyr")
library("pscl")
library("MASS")
library(NBZIMM)
library("lfe")
library("lme4")
library("stargazer")
source('Preprocessing_v2.R')
# main analysis
glmm.zinb.off = glmm.zinb(fixed = Deaths ~ mean_pm25 +scale(poverty) + scale(popdensity)  +scale(medianhousevalue)
+scale(medhouseholdincome) + scale(pct_owner_occ)  +scale(hispanic)
+scale(education)  +scale(pct_blk) + scale(older_pecent)
+ scale(totalTestResults) +
+ scale(beds)
+ scale(mean_bmi) + scale(smoke_rate)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ offset(log(population)),
random = ~ 1 | state, data = (aggregate_pm_census_cdc_test_beds))
intervals(glmm.zinb.off, level=0.95)$fixed[2,]
cat("N: ", glmm.zinb.off$dims$N)
# main analysis
glmm.zinb.counties = glmm.zinb(fixed = Deaths ~ mean_pm25 +scale(poverty) + scale(popdensity)  +scale(medianhousevalue)
+scale(medhouseholdincome) + scale(pct_owner_occ)  +scale(hispanic)
+scale(education)  +scale(pct_blk) + scale(older_pecent)
+ scale(totalTestResults)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm)
+ scale(mean_winter_rm)
+ offset(log(population)),
random = ~ 1 | state, data = (aggregate_pm_census_cdc_test_beds))
cat('5%, Estimate, 95%:',intervals(glmm.zinb.counties, level=0.95)$fixed[2,], '\n')
cat("N: ", glmm.zinb.counties$dims$N)
# Initial FE setup
output.new.1 <- felm(log(Deaths+1) ~ mean_pm25+scale(poverty) +scale(medianhousevalue)
+ scale(pct_owner_occ)  +scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ scale(totalTestResults)
+ log(population)|factor(q_popdensity) +state+factor(first_case_week)+ factor(education_bins)+ factor(income_bins)  |0|popdensity_bins, cmethod="reghdfe", data = df)
# Looking at deaths per capita
output.new.2 <- felm(deaths_per_capita ~ mean_pm25+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME+scale(poverty) +scale(medianhousevalue)
+ scale(pct_owner_occ)  +scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ scale(totalTestResults)
+ log(population)|factor(q_popdensity) +state+factor(first_case_week)+ factor(education_bins)+ factor(income_bins)  |0|popdensity_bins, cmethod="reghdfe", data = df)
# Incorporating transportation method
output.new.3 <- felm(log(Deaths+1) ~ mean_pm25
+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME
+ scale(poverty) +scale(medianhousevalue)
+ scale(pct_owner_occ)  +scale(hispanic) + scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ scale(totalTestResults)
+ log(population)
|factor(q_popdensity) + state + factor(first_case_week)+ factor(education_bins)+ factor(income_bins)
|0|popdensity_bins, cmethod="reghdfe", data = df)
stargazer(output.new.1, output.new.3, output.new.2, title= "All counties", keep=c("mean_pm25"), omit.stat = c("LL","ser","f","rsq"), style = "qje"
, dep.var.labels=c("log(Deaths)", "Deaths per Capita")
, add.lines=list(c("Controls + FE", "X", "X","X"), c("Transportation", "","X", "X")), type='html')
# Ideal regression
output.new.4 <- felm(log(Deaths + (Deaths^2+1)^0.5) ~ mean_pm25+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME+poverty +medianhousevalue + pct_owner_occ  +hispanic + pct_blk +older_pecent+ mean_summer_temp + mean_winter_temp + mean_summer_rm + mean_winter_rm + totalTestResults+ log(population)|factor(q_popdensity) +factor(first_case_week) + factor(state)+ factor(education_bins)+ factor(income_bins)  |0|popdensity_bins, cmethod="reghdfe", data = df)
stargazer(output.new.4, title= "Counties with Death>0", keep=c("mean_pm25"), omit.stat = c("LL","ser","f","rsq"), style = "qje"
, dep.var.labels=c("hsin(Deaths)")
, add.lines=list(c("Controls + FE", "X"), c("Transportation","X")), type='html')
library("tidyverse")
coef_list <- c()
lb_list<- c()
ub_list<-c()
for(date in time_series_columns){
eq <- paste(date,"~ mean_pm25 +scale(poverty) + scale(popdensity)  +scale(medianhousevalue) +scale(medhouseholdincome) + scale(pct_owner_occ)  +scale(hispanic) +scale(education)  +scale(pct_blk) + scale(older_pecent) + scale(totalTestResults) + scale(beds) + scale(mean_bmi) + scale(smoke_rate)+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)+ offset(log(population))")
glmm.zinb.off = glmm.zinb(fixed =as.formula(eq),
random = ~ 1 | state, data = (aggregate_pm_census_cdc_test_beds))
temp_list <- intervals(glmm.zinb.off, level=0.95)$fixed[2,]
coef_list <- c(coef_list,temp_list[2])
lb_list <- c(lb_list, temp_list[1])
ub_list <- c(ub_list, temp_list[3])
}
library("tidyverse")
coef_list <- c()
lb_list<- c()
ub_list<-c()
for(date in time_series_columns){
eq <- paste(date,"~ mean_pm25 +scale(poverty) + scale(popdensity)  +scale(medianhousevalue) +scale(medhouseholdincome) + scale(pct_owner_occ)  +scale(hispanic) +scale(education)  +scale(pct_blk) + scale(older_pecent) + scale(totalTestResults) + scale(beds) + scale(mean_bmi) + scale(smoke_rate)+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)+ offset(log(population))")
glmm.zinb.off = glmm.zinb(fixed =as.formula(eq), random = ~ 1 | state, data =df)
temp_list <- intervals(glmm.zinb.off, level=0.95)$fixed[2,]
coef_list <- c(coef_list,temp_list[2])
lb_list <- c(lb_list, temp_list[1])
ub_list <- c(ub_list, temp_list[3])
}
time_series_estimate <- data.frame(est = coef_list,
lb = lb_list,
ub = ub_list,
model = time_series_columns)
time_series_estimate$model <- factor(time_series_estimate$model, levels = time_series_estimate$model)
ggplot(time_series_estimate, aes(x = model, y = est)) +
geom_point() +
geom_errorbar(aes(ymin = lb, ymax = ub), width = 0.1) +
xlab("") +
ylab("Historical predictor")
library("tidyverse")
coef_list <- c()
lb_list<- c()
ub_list<-c()
for(date in time_series_columns){
eq <- paste0("log(",date," + (",date,"^2+1)^0.5) ~ mean_pm25+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME+poverty +medianhousevalue + pct_owner_occ  +hispanic + pct_blk +older_pecent+ mean_summer_temp + mean_winter_temp + mean_summer_rm + mean_winter_rm + totalTestResults+ log(population)|factor(q_popdensity) +factor(first_case_week) + factor(state)+ factor(education_bins)+ factor(income_bins)  |0|state")
output.new.temp <- felm(as.formula(eq), cmethod="reghdfe", data = df)
coef_list <- c(coef_list,coef(output.new.temp)["mean_pm25"])
lb_list <- c(lb_list, confint(output.new.temp, level = 0.95)["mean_pm25", ][1])
ub_list <- c(ub_list, confint(output.new.temp, level = 0.95)["mean_pm25", ][2])
}
time_series_estimate <- data.frame(est = coef_list,
lb = lb_list,
ub = ub_list,
model = time_series_columns)
time_series_estimate$model <- factor(time_series_estimate$model, levels = time_series_estimate$model)
ggplot(time_series_estimate, aes(x = model, y = est)) +
geom_point() +
geom_errorbar(aes(ymin = lb, ymax = ub), width = 0.1) +
xlab("") +
ylab("Historical predictor")
library("tidyverse")
coef_list <- c()
lb_list<- c()
ub_list<-c()
for(date in time_series_columns){
eq <- paste0("log(",date," + (",date,"^2+1)^0.5) ~ mean_pm25+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME+poverty +medianhousevalue + pct_owner_occ  +hispanic + pct_blk +older_pecent+ mean_summer_temp + mean_winter_temp + mean_summer_rm + mean_winter_rm + totalTestResults+ log(population)|factor(q_popdensity) +factor(first_case_week) + factor(state)+ factor(education_bins)+ factor(income_bins)  |0|state")
output.new.temp <- felm(as.formula(eq), cmethod="reghdfe", data = df)
coef_list <- c(coef_list,coef(output.new.temp)["mean_pm25"])
lb_list <- c(lb_list, confint(output.new.temp, level = 0.95)["mean_pm25", ][1])
ub_list <- c(ub_list, confint(output.new.temp, level = 0.95)["mean_pm25", ][2])
}
time_series_estimate <- data.frame(est = coef_list,
lb = lb_list,
ub = ub_list,
model = time_series_columns)
time_series_estimate$model <- factor(time_series_estimate$model, levels = time_series_estimate$model)
ggplot(time_series_estimate, aes(x = model, y = est)) +
geom_point() +
geom_errorbar(aes(ymin = lb, ymax = ub), width = 0.1) +
xlab("") +
ylab("Historical predictor")
library("tidyr")
library("pscl")
library("MASS")
library(NBZIMM)
library("lfe")
library("lme4")
library("stargazer")
source('Preprocessing_v2.R')
# main analysis
glmm.zinb.off = glmm.zinb(fixed = Deaths ~ mean_pm25 +scale(poverty) + scale(popdensity)  +scale(medianhousevalue)
+scale(medhouseholdincome) + scale(pct_owner_occ)  +scale(hispanic)
+scale(education)  +scale(pct_blk) + scale(older_pecent)
+ scale(totalTestResults) +
+ scale(beds)
+ scale(mean_bmi) + scale(smoke_rate)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ offset(log(population)),
random = ~ 1 | state, data = (aggregate_pm_census_cdc_test_beds))
intervals(glmm.zinb.off, level=0.95)$fixed[2,]
cat("N: ", glmm.zinb.off$dims$N)
# main analysis
glmm.zinb.counties = glmm.zinb(fixed = Deaths ~ mean_pm25 +scale(poverty) + scale(popdensity)  +scale(medianhousevalue)
+scale(medhouseholdincome) + scale(pct_owner_occ)  +scale(hispanic)
+scale(education)  +scale(pct_blk) + scale(older_pecent)
+ scale(totalTestResults)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm)
+ scale(mean_winter_rm)
+ offset(log(population)),
random = ~ 1 | state, data = (aggregate_pm_census_cdc_test_beds))
cat('5%, Estimate, 95%:',intervals(glmm.zinb.counties, level=0.95)$fixed[2,], '\n')
cat("N: ", glmm.zinb.counties$dims$N)
$$ log(Deaths_i) = \beta_0 + \beta_1 PM_{2.5, i} + Controls_i + FEs_i + \epsilon_i$$
$$ Deaths_i/pop_i = \beta_0 + \beta_1 PM_{2.5, i} + Controls_i + FEs_i + \epsilon_i$$
Finally, I will change the structure of some of the variables: income and educations will be restructured into 5 bins, beds will be per capita. Below we run three regressions: (1) baseline regression similar to the setup in the study, (2) changing the y variable to be deaths per capita, (3) adding transportation
# Initial FE setup
output.new.1 <- felm(log(Deaths+1) ~ mean_pm25+scale(poverty) +scale(medianhousevalue)
+ scale(pct_owner_occ)  +scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ scale(totalTestResults)
+ log(population)|factor(q_popdensity) +state+factor(first_case_week)+ factor(education_bins)+ factor(income_bins)  |0|popdensity_bins, cmethod="reghdfe", data = df)
# Looking at deaths per capita
output.new.2 <- felm(deaths_per_capita ~ mean_pm25+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME+scale(poverty) +scale(medianhousevalue)
+ scale(pct_owner_occ)  +scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ scale(totalTestResults)
+ log(population)|factor(q_popdensity) +state+factor(first_case_week)+ factor(education_bins)+ factor(income_bins)  |0|popdensity_bins, cmethod="reghdfe", data = df)
# Incorporating transportation method
output.new.3 <- felm(log(Deaths+1) ~ mean_pm25
+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME
+ scale(poverty) +scale(medianhousevalue)
+ scale(pct_owner_occ)  +scale(hispanic) + scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ scale(totalTestResults)
+ log(population)
|factor(q_popdensity) + state + factor(first_case_week)+ factor(education_bins)+ factor(income_bins)
|0|popdensity_bins, cmethod="reghdfe", data = df)
stargazer(output.new.1, output.new.3, output.new.2, title= "All counties", keep=c("mean_pm25"), omit.stat = c("LL","ser","f","rsq"), style = "qje"
, dep.var.labels=c("log(Deaths)", "Deaths per Capita")
, add.lines=list(c("Controls + FE", "X", "X","X"), c("Transportation", "","X", "X")), type='html')
# Initial FE setup
output.new.1 <- felm(log(Deaths+1) ~ mean_pm25+scale(poverty) +scale(medianhousevalue)
+ scale(pct_owner_occ)  +scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ scale(totalTestResults)
+ log(population)|factor(q_popdensity) +state+factor(first_case_week)+ factor(education_bins)+ factor(income_bins)  |0|state, cmethod="reghdfe", data = df)
# Looking at deaths per capita
output.new.2 <- felm(deaths_per_capita ~ mean_pm25+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME+scale(poverty) +scale(medianhousevalue)
+ scale(pct_owner_occ)  +scale(hispanic)
+ scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ scale(totalTestResults)
+ log(population)|factor(q_popdensity) +state+factor(first_case_week)+ factor(education_bins)+ factor(income_bins)  |0|state, cmethod="reghdfe", data = df)
# Incorporating transportation method
output.new.3 <- felm(log(Deaths+1) ~ mean_pm25
+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME
+ scale(poverty) +scale(medianhousevalue)
+ scale(pct_owner_occ)  +scale(hispanic) + scale(pct_blk) + scale(older_pecent)
+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)
+ scale(totalTestResults)
+ log(population)
|factor(q_popdensity) + state + factor(first_case_week)+ factor(education_bins)+ factor(income_bins)
|0|state, cmethod="reghdfe", data = df)
stargazer(output.new.1, output.new.3, output.new.2, title= "All counties", keep=c("mean_pm25"), omit.stat = c("LL","ser","f","rsq"), style = "qje"
, dep.var.labels=c("log(Deaths)", "Deaths per Capita")
, add.lines=list(c("Controls + FE", "X", "X","X"), c("Transportation", "","X", "X")), type='html')
# Ideal regression
output.new.4 <- felm(log(Deaths + (Deaths^2+1)^0.5) ~ mean_pm25+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME+poverty +medianhousevalue + pct_owner_occ  +hispanic + pct_blk +older_pecent+ mean_summer_temp + mean_winter_temp + mean_summer_rm + mean_winter_rm + totalTestResults+ log(population)|factor(q_popdensity) +factor(first_case_week) + factor(state)+ factor(education_bins)+ factor(income_bins)  |0|popdensity_bins, cmethod="reghdfe", data = df)
stargazer(output.new.4, title= "Counties with Death>0", keep=c("mean_pm25"), omit.stat = c("LL","ser","f","rsq"), style = "qje"
, dep.var.labels=c("hsin(Deaths)")
, add.lines=list(c("Controls + FE", "X"), c("Transportation","X")), type='html')
library("tidyverse")
coef_list <- c()
lb_list<- c()
ub_list<-c()
for(date in time_series_columns){
eq <- paste(date,"~ mean_pm25 +scale(poverty) + scale(popdensity)  +scale(medianhousevalue) +scale(medhouseholdincome) + scale(pct_owner_occ)  +scale(hispanic) +scale(education)  +scale(pct_blk) + scale(older_pecent) + scale(totalTestResults) + scale(beds) + scale(mean_bmi) + scale(smoke_rate)+ scale(mean_summer_temp) + scale(mean_winter_temp) + scale(mean_summer_rm) + scale(mean_winter_rm)+ offset(log(population))")
glmm.zinb.off = glmm.zinb(fixed =as.formula(eq), random = ~ 1 | state, data =df)
temp_list <- intervals(glmm.zinb.off, level=0.95)$fixed[2,]
coef_list <- c(coef_list,temp_list[2])
lb_list <- c(lb_list, temp_list[1])
ub_list <- c(ub_list, temp_list[3])
}
time_series_estimate <- data.frame(est = coef_list,
lb = lb_list,
ub = ub_list,
model = time_series_columns)
time_series_estimate$model <- factor(time_series_estimate$model, levels = time_series_estimate$model)
ggplot(time_series_estimate, aes(x = model, y = est)) +
geom_point() +
geom_errorbar(aes(ymin = lb, ymax = ub), width = 0.1) +
xlab("") +
ylab("Historical predictor")
library("tidyverse")
coef_list <- c()
lb_list<- c()
ub_list<-c()
for(date in time_series_columns){
eq <- paste0("log(",date," + (",date,"^2+1)^0.5) ~ mean_pm25+WRK_Drive +WRK_PublicTransit +WRK_Bike +WRK_Walk +WRKHOME+poverty +medianhousevalue + pct_owner_occ  +hispanic + pct_blk +older_pecent+ mean_summer_temp + mean_winter_temp + mean_summer_rm + mean_winter_rm + totalTestResults+ log(population)|factor(q_popdensity) +factor(first_case_week) + factor(state)+ factor(education_bins)+ factor(income_bins)  |0|state")
output.new.temp <- felm(as.formula(eq), cmethod="reghdfe", data = df)
coef_list <- c(coef_list,coef(output.new.temp)["mean_pm25"])
lb_list <- c(lb_list, confint(output.new.temp, level = 0.95)["mean_pm25", ][1])
ub_list <- c(ub_list, confint(output.new.temp, level = 0.95)["mean_pm25", ][2])
}
time_series_estimate <- data.frame(est = coef_list,
lb = lb_list,
ub = ub_list,
model = time_series_columns)
time_series_estimate$model <- factor(time_series_estimate$model, levels = time_series_estimate$model)
ggplot(time_series_estimate, aes(x = model, y = est)) +
geom_point() +
geom_errorbar(aes(ymin = lb, ymax = ub), width = 0.1) +
xlab("") +
ylab("Historical predictor")
